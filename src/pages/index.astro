---
import BaseLayout from '../layouts/BaseLayout.astro';
import Card from '../components/Card.astro';
import Search from '../components/Search.astro';
import { getCollection } from 'astro:content';

const articles = await getCollection('articles');
const guides = await getCollection('guides');
const base = import.meta.env.BASE_URL;
---

<BaseLayout title="Home">
  <header>
    <div class="logo">üöÄ</div>
    <h1 class="gradient-title">Software Engineering 3.0</h1>
    <p class="tagline">Raccolta di articoli e guide sul mondo dello sviluppo software nell'era dell'AI</p>
  </header>

  <Search />

  <div class="controls">
    <div class="filters">
      <button class="filter-btn active" data-filter="all">Tutti</button>
      <button class="filter-btn" data-filter="article">Articoli</button>
      <button class="filter-btn" data-filter="guide">Guide</button>
    </div>
    <div class="sorting">
      <span class="sort-label">Ordina:</span>
      <button class="sort-btn active" data-sort="date-desc">Pi√π recenti</button>
      <button class="sort-btn" data-sort="date-asc">Pi√π vecchi</button>
      <button class="sort-btn" data-sort="alpha">A-Z</button>
    </div>
  </div>

  <div class="cards-grid" id="cards-grid">
    {articles.map((article) => (
      <Card
        title={article.data.title}
        description={article.data.description}
        icon={article.data.icon}
        href={`${base}/articles/${article.slug}`}
        type="article"
        tag={article.data.tag}
        date={article.data.date}
      />
    ))}

    {guides.map((guide) => (
      <Card
        title={guide.data.title}
        description={guide.data.description}
        icon={guide.data.icon}
        href={`${base}/guides/${guide.slug}`}
        type="guide"
        tag={guide.data.tag}
        date={guide.data.date}
      />
    ))}
  </div>

  <div class="setup-section">
    <h2>Setup Automation</h2>
    <p>Configura il tuo ambiente di sviluppo automaticamente con Claude Code.</p>
    <div class="setup-cards">
      <a href={`${base}/setup/macos.md`} class="setup-card">
        <span class="setup-icon">üçé</span>
        <span class="setup-title">macOS Setup</span>
        <span class="setup-desc">Homebrew, Node, Python, Docker</span>
      </a>
      <a href={`${base}/setup/windows.md`} class="setup-card">
        <span class="setup-icon">ü™ü</span>
        <span class="setup-title">Windows Setup</span>
        <span class="setup-desc">winget, Scoop, WSL2, Node, Python</span>
      </a>
    </div>
    <p class="setup-hint">Apri questa repo con <a href="https://claude.ai/claude-code" target="_blank">Claude Code</a> e chiedi di leggere il file di setup ed eseguire i comandi.</p>
  </div>
</BaseLayout>

<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const sortBtns = document.querySelectorAll('.sort-btn');
  const grid = document.getElementById('cards-grid');
  let currentFilter = 'all';

  // Filter functionality
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.dataset.filter;
      applyFilter();
    });
  });

  function applyFilter() {
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
      if (currentFilter === 'all' || card.dataset.type === currentFilter) {
        card.classList.remove('hidden');
      } else {
        card.classList.add('hidden');
      }
    });
  }

  // Sort functionality
  sortBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      sortBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      sortCards(btn.dataset.sort);
    });
  });

  function sortCards(sortType) {
    const cards = Array.from(grid.querySelectorAll('.card'));

    cards.sort((a, b) => {
      if (sortType === 'date-desc') {
        return b.dataset.date.localeCompare(a.dataset.date);
      } else if (sortType === 'date-asc') {
        return a.dataset.date.localeCompare(b.dataset.date);
      } else if (sortType === 'alpha') {
        return a.dataset.title.localeCompare(b.dataset.title);
      }
      return 0;
    });

    cards.forEach(card => grid.appendChild(card));
    applyFilter();
  }

  // Initial sort by date descending
  sortCards('date-desc');
</script>
